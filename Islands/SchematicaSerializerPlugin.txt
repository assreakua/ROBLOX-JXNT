local Serializer = {}

do
	local min = math.min
	local max = math.max
	local round = math.round

	Serializer.__index = Serializer

	local function Round(Number) 
		if typeof(Number) == "number" then
			return round(Number / 3) * 3
		end
	end

	function Serializer.new(Model)
		local self = setmetatable({}, Serializer)

		self.Model = Model
		
		return self
	end
	
	function Serializer:Format(CF)
		local x, y, z, m11, m12, m13, m21, m22, m23, m31, m32, m33 = CF:components()
		return CFrame.new(Round(x), Round(y), Round(z), m11, m12, m13, m21, m22, m23, m31, m32, m33)
	end

	function Serializer:Serialize()
		local CF, Size = self.Model:GetBoundingBox()
		local Start, End = CF.Position - Size / 2, CF.Position + Size / 2
		local Center = self:Format(CFrame.new((Start + End) / 2)) - Vector3.new(2, 0, 2)
		
		local Output = {}
		
		for i, v in next, self.Model:GetChildren() do
			local Inserted = {}
			if Output[v.Name] == nil then 
				Output[v.Name] = {}
			end
			if v.PrimaryPart then
				Inserted.C = {self:Format(Center:ToObjectSpace(v.PrimaryPart.CFrame)):components()}
			else
				print("OMG WARNING SOMETHING DIDNT GET INSERTED: "..v.Name)
			end
			if v:FindFirstChild("TextBox", true) then
				Inserted.T = v:FindFirstChild("TextBox", true).Text.Value
			end
			
			table.insert(Output[v.Name], Inserted)
		end
		
		return {Size = {Round(Size.X), Round(Size.Y), Round(Size.Z)}, Blocks = Output}
	end
end

return Serializer